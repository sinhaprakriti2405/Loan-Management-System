<div class="apply-wrapper">

  <!-- ===== LOAN TYPE SELECTION ===== -->
  <h2>Select Loan Type</h2>

  <div class="loan-type-grid">

  <mat-card
    class="loan-type-card"
    *ngFor="let lt of loanTypes()"
    (click)="selectLoanType(lt)"
    [class.active]="selectedLoanType()?.loanTypeId === lt.loanTypeId">

    <!-- HEADER WITH SMALL ICON -->
    <div class="loan-card-header">
      <mat-icon class="loan-icon-small">
        {{
          lt.name === 'Personal' ? 'person' :
          lt.name === 'Home' ? 'home' :
          lt.name === 'Vehicle' ? 'directions_car' :
          'school'
        }}
      </mat-icon>

      <h3>{{ lt.name }}</h3>
    </div>

    <div class="loan-details">
      <p><strong>Interest:</strong> {{ lt.interestRate }}%</p>
      <p><strong>Max Tenure:</strong> {{ lt.maxTenure }} months</p>
      <p>
        <strong>Amount:</strong>
        ₹ {{ lt.minAmount }} – ₹ {{ lt.maxAmount }}
      </p>
    </div>

  </mat-card>

</div>


  <!-- ===== APPLY FORM ===== -->
  <mat-card *ngIf="selectedLoanType()" class="apply-card">

    <h2>Apply for {{ selectedLoanType()?.name }} </h2>

    <form [formGroup]="form" (ngSubmit)="applyLoan()">

      <!-- LOAN TYPE (AUTO FILLED) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Loan Type</mat-label>
        <input matInput [value]="selectedLoanType()?.name" disabled />
      </mat-form-field>

      <!-- AMOUNT -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Loan Amount</mat-label>
        <input matInput type="number" formControlName="amount" />
      </mat-form-field>

      <!-- TENURE -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tenure (months)</mat-label>
        <input matInput type="number" formControlName="tenure" />
      </mat-form-field>

      <!-- ANNUAL INCOME -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Annual Income</mat-label>
        <input matInput type="number" formControlName="annualIncome" />
      </mat-form-field>

      <mat-error *ngIf="form.get('amount')?.errors?.['min']">
        Amount must be at least ₹ {{ selectedLoanType()?.minAmount }}
      </mat-error>

      <mat-error *ngIf="form.get('amount')?.errors?.['max']">
        Amount cannot exceed ₹ {{ selectedLoanType()?.maxAmount }}
      </mat-error>


      <mat-error *ngIf="form.get('tenure')?.errors?.['max']">
        Tenure cannot exceed {{ selectedLoanType()?.maxTenure }} months
      </mat-error>



      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="loading() || form.invalid">
        {{ loading() ? 'Applying...' : 'Apply Loan' }}
      </button>

      <div
        *ngIf="message()"
        class="info-message"
        [ngClass]="{
          success: message()?.includes('successfully'),
          error: message()?.includes('failed')
        }">
        {{ message() }}
      </div>

    </form>

  </mat-card>

</div>
