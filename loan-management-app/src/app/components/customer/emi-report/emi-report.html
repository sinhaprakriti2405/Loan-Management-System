<mat-card *ngIf="!loanStatus" class="status-card pending">
  <div class="icon-wrap">
    <mat-icon>info</mat-icon>
  </div>
  <div>
    <h2>Status Pending</h2>
    <p>Loan status not yet updated.</p>
  </div>
</mat-card>


<div *ngIf="!loading()" class="emi-wrapper">

  <!-- ===== REJECTED ===== -->
  <mat-card *ngIf="loanStatus === 'Rejected'" class="status-card rejected">
  <div class="icon-wrap">
    <mat-icon>cancel</mat-icon>
  </div>
  <div>
    <h2>Loan Rejected</h2>
    <p>
      <strong>Reason:</strong>
      {{ remarks || 'No remarks provided by loan officer.' }}
    </p>
  </div>
</mat-card>


  <!-- ===== PENDING ===== -->
  <mat-card *ngIf="loanStatus === 'Applied'" class="status-card pending">
  <div class="icon-wrap">
    <mat-icon>hourglass_top</mat-icon>
  </div>
  <div>
    <h2>Loan Under Review</h2>
    <p>Your application is being evaluated.</p>
  </div>
</mat-card>


  <!-- ===== APPROVED / CLOSED ===== -->
  <ng-container *ngIf="loanStatus === 'Approved' || loanStatus === 'Closed'">

    <!-- SUMMARY -->
    <div class="summary-grid">
    <mat-card class="summary-card">
      <div class="icon-wrap">
        <mat-icon>currency_rupee</mat-icon>
      </div>
      <div>
        <h4>Total Loan</h4>
        <p>₹ {{ accountSummary()?.totalLoanAmount }}</p>
      </div>
    </mat-card>


      <mat-card class="summary-card">
        <div class="icon-wrap">
        <mat-icon>pending_actions</mat-icon>
        </div>
        <div>
          <h4>Outstanding</h4>
          <p>₹ {{ accountSummary()?.outstandingAmount }}</p>
        </div>
      </mat-card>

      <mat-card class="summary-card">
        <div class="icon-wrap">
        <mat-icon>check_circle</mat-icon>
        </div>
        <div>
          <h4>Paid EMIs</h4>
          <p>{{ accountSummary()?.paidEmis }}</p>
        </div>
      </mat-card>

      <mat-card class="summary-card">
        <div class="icon-wrap">
        <mat-icon>schedule</mat-icon>
        </div>
        <div>
          <h4>Pending EMIs</h4>
          <p>{{ accountSummary()?.pendingEmis }}</p>
        </div>
      </mat-card>
    </div>

    <!-- CLOSED BADGE -->
<mat-card *ngIf="loanStatus === 'Closed'" class="status-card closed">
  <div class="icon-wrap">
    <mat-icon>lock</mat-icon>
  </div>
  <h3>This loan has been closed</h3>
</mat-card>

    <!-- EMI TABLE -->
    <mat-card class="table-card">
      <h2>EMI Schedule</h2>

      <table mat-table [dataSource]="emis()" class="emi-table">

        <ng-container matColumnDef="installmentNumber">
          <th mat-header-cell *matHeaderCellDef>EMI</th>
          <td mat-cell *matCellDef="let e">#{{ e.installmentNumber }}</td>
        </ng-container>

        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef>Due Date</th>
          <td mat-cell *matCellDef="let e">
            {{ e.dueDate | date:'mediumDate' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let e">₹ {{ e.amount }}</td>
        </ng-container>

        <ng-container matColumnDef="paidStatus">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let e">

            <span
              *ngIf="!e.paidStatus"
              class="emi-chip pending"
              [class.disabled]="loanStatus === 'Closed'"
              (click)="goToPayEmi(e)">
              Pay Now
            </span>

            <span *ngIf="e.paidStatus" class="emi-chip paid">
              Paid
            </span>

          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </mat-card>

  </ng-container>
</div>
