<div *ngIf="!loading()" class="loan-details-wrapper">

  <!-- ===== STATUS CARD ===== -->
  <mat-card class="status-card" [ngClass]="loanStatus">
    <h2>Loan Status:</h2>
    <p class="status-text">{{ loanStatus }}</p>
    <p class="loan-id">Loan ID: {{ loanId }}</p>
  </mat-card>

  <!-- ===== ACCOUNT SUMMARY ===== -->
  <mat-card class="summary-card" *ngIf="accountSummary()">
    <h3>Account Summary</h3>

    <div class="summary-grid">
      <div class="summary-item">
        <span>Total Loan Amount</span>
        <strong>₹ {{ accountSummary().totalLoanAmount }}</strong>
      </div>

      <div class="summary-item">
        <span>Outstanding Amount</span>
        <strong>₹ {{ accountSummary().outstandingAmount }}</strong>
      </div>

      <div class="summary-item">
        <span>Paid EMIs</span>
        <strong>{{ accountSummary().paidEmis }}</strong>
      </div>

      <div class="summary-item">
        <span>Pending EMIs</span>
        <strong>{{ accountSummary().pendingEmis }}</strong>
      </div>
    </div>
  </mat-card>

  <!-- ===== EMI TABLE ===== -->
  <mat-card class="table-card" *ngIf="emis().length > 0">
    <h3>EMI Schedule</h3>

    <table mat-table [dataSource]="emis()" class="loan-table">

      <ng-container matColumnDef="installmentNumber">
        <th mat-header-cell *matHeaderCellDef>EMI No</th>
        <td mat-cell *matCellDef="let e">{{ e.installmentNumber }}</td>
      </ng-container>

      <ng-container matColumnDef="dueDate">
        <th mat-header-cell *matHeaderCellDef>Due Date</th>
        <td mat-cell *matCellDef="let e">
          {{ e.dueDate | date:'mediumDate' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Amount</th>
        <td mat-cell *matCellDef="let e">
          ₹ {{ e.amount }}
        </td>
      </ng-container>

      <ng-container matColumnDef="paidStatus">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let e">
          <span
            class="status-chip"
            [ngClass]="e.paidStatus ? 'paid' : 'pending'">
            {{ e.paidStatus ? 'Paid' : 'Pending' }}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </mat-card>

</div>
